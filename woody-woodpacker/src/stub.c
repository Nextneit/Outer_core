#include "../woody-woodpacker.h"

// ✅ DEFINICIÓN - Solo aquí
unsigned char decryption_stub[] = {
    // Mostrar "....WOODY....."
    0x48, 0xc7, 0xc0, 0x01, 0x00, 0x00, 0x00,   // mov rax, 1
    0x48, 0xc7, 0xc7, 0x01, 0x00, 0x00, 0x00,   // mov rdi, 1
    0x48, 0xc7, 0xc6, 0x00, 0x00, 0x00, 0x00,   // mov rsi, msg_addr
    0x48, 0xc7, 0xc2, 0x0f, 0x00, 0x00, 0x00,   // mov rdx, 15
    0x0f, 0x05,                                   // syscall
    
    // Desencriptación
    0x48, 0xc7, 0xc0, 0x00, 0x00, 0x00, 0x00,   // mov rax, data_addr
    0x48, 0xc7, 0xc1, 0x00, 0x00, 0x00, 0x00,   // mov rcx, size
    0x48, 0xc7, 0xc2, 0x00, 0x00, 0x00, 0x00,   // mov rdx, key
    
    // Loop
    0x30, 0x10,                                   // xor [rax], dl
    0x48, 0xff, 0xc0,                            // inc rax
    0x48, 0xff, 0xc9,                            // dec rcx
    0x75, 0xf6,                                   // jnz loop
    
    // Saltar al original
    0x48, 0xb8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // mov rax, original_entry
    0xff, 0xe0                                    // jmp rax
};

size_t decryption_stub_size = sizeof(decryption_stub);

unsigned char woody_message[] = "....WOODY.....\n";
size_t woody_message_size = sizeof(woody_message) - 1;